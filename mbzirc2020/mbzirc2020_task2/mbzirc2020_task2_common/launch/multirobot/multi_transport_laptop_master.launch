<?xml version="1.0"?>
<launch>
  <arg name="robot1_id" default="1" />
  <arg name="robot1_ns" value="hydrus$(arg robot1_id)"/>
  <arg name="robot1_recognition" default="true"/>

  <arg name="robot2_id" default="2" />
  <arg name="robot2_ns" value="hydrus$(arg robot2_id)"/>
  <arg name="robot2_recognition" default="true"/>

  <arg name="sim" default="False"/>
  <arg name="simulation" default="$(arg sim)" />
  <arg name="real" default="True"/>
  <arg name="real_machine" default="$(arg real)" />
  <arg name="headless" default="True" />
  <arg name="estimate_mode" default="0" />

  <arg name="outdoor" default="True" />
  <arg name="worldtype" default="kashiwa_202104" if="$(arg outdoor)"/>
  <arg name="worldtype" default="kashiwa113" unless="$(arg outdoor)"/>
  <arg name="config_version" default="_202104" if="$(arg outdoor)"/>
  <arg name="config_version" default="" unless="$(arg outdoor)"/>

  <arg name="config_dir" value="$(find mbzirc2020_task2_common)/config/challenge/$(arg worldtype)$(arg config_version)" if="$(arg real_machine)"/>
  <arg name="config_dir" value="$(find mbzirc2020_task2_simulation)/config/$(arg worldtype)" if="$(arg simulation)"/>

  <arg name="ball_joint_gripper" default="True"/>
  <arg name="ring_gripper" default="False" />
  <arg name="object_color" default="red" />

  <arg name="rviz_config_path" default="$(find mbzirc2020_task2_simulation)/config/multi_transport_rviz_config"/>

  <group if="$(arg real_machine)">
    # joy_stick for the leader machine
    <include file="$(find aerial_robot_base)/launch/external_module/joy_stick.launch">
      <arg name="robot_name" value="$(arg robot_ns_leader)"/>
    </include>

    # passing joy_stick values to the follower machine
    <node name="joy_stick_bridge" pkg="mbzirc2020_task2_common" type="joy_stick_bridge.py" output="screen">
      <param name="robot_ns_master" value="$(arg robot1_ns)"/>
      <param name="robot_ns_slave" value="$(arg robot2_ns)"/>
    </node>
  </group>


  <group if="$(arg simulation)">
    # leader machine
    <include file="$(find mbzirc2020_task2_common)/launch/multirobot/multi_transport_agent.launch">
      <arg name="robot_id"  value="$(arg robot1_id)" />
      <arg name="ring_gripper" value="$(arg ring_gripper)"/>
      <arg name="ball_joint_gripper" value="$(arg ball_joint_gripper)" />
      <arg name="simulation" value="true" />
      <arg name="real_machine" value="false" />
      <arg name="headless" value="$(arg headless)" />
      <arg name="worldtype" value="$(arg worldtype)" />
      <arg name="config_dir" value="$(arg config_dir)" />
      <arg name="object_color" value="$(arg object_color)" />
      <arg name="launch_gazebo" value="true" />
      <arg name="outdoor" value="$(arg outdoor)" />
      <arg name="estimate_mode"  value= "$(arg estimate_mode)" />
      <arg name="recognition" value="$(arg robot1_recognition)" />
      <arg name="rviz_config_path" value="$(arg rviz_config_path)" />
      <arg name="spawn_x" default="1.8" if="$(arg outdoor)" />
      <arg name="spawn_y" default="0.2" if="$(arg outdoor)" />
      <arg name="spawn_yaw" default="2.36" if="$(arg outdoor)" />
      <arg name="spawn_x" default="-1.65" unless="$(arg outdoor)" />
      <arg name="spawn_y" default="0.2" unless="$(arg outdoor)" />
      <arg name="spawn_yaw" default="2.36" unless="$(arg outdoor)" />
    </include>

    # follower machine
    <include file="$(find mbzirc2020_task2_common)/launch/multirobot/multi_transport_agent.launch">
      <arg name="robot_id"  value="$(arg robot2_id)" />
      <arg name="ring_gripper" value="$(arg ring_gripper)" />
      <arg name="ball_joint_gripper" value="$(arg ball_joint_gripper)" />
      <arg name="simulation" value="true" />
      <arg name="real_machine" value="false" />
      <arg name="headless" value="true" />
      <arg name="config_dir" value="$(arg config_dir)" />
      <arg name="object_color" value="$(arg object_color)" />
      <arg name="launch_gazebo" value="false" />
      <arg name="outdoor" value="$(arg outdoor)" />
      <arg name="estimate_mode"  value= "$(arg estimate_mode)" />
      <arg name="recognition" value="$(arg robot2_recognition)" />
      <arg name="worldtype" value="$(arg worldtype)" />
      <arg name="spawn_x" default="0.1" if="$(arg outdoor)" />
      <arg name="spawn_y" default="-0.2" if="$(arg outdoor)" />
      <arg name="spawn_yaw" default="-0.78" if="$(arg outdoor)" />
      <arg name="spawn_x" default="-3.35" unless="$(arg outdoor)" />
      <arg name="spawn_y" default="-0.2" unless="$(arg outdoor)" />
      <arg name="spawn_yaw" default="-0.78" unless="$(arg outdoor)" />
    </include>

  </group>

  # master PC task
  <!-- <node name="two_hydrus_task" -->
  <!--       type="two_hydrus_task.py" -->
  <!--       pkg="mbzirc2020_task2_tasks" -->
  <!--       output="screen"> -->
  <!--   <param name="robot_ns_leader" value="$(arg robot_ns_leader)"/> -->
  <!--   <param name="robot_ns_follower" value="$(arg robot_ns_follower)"/> -->
  <!-- </node> -->

  <node pkg="smach_viewer" type="smach_viewer.py" name="smach_viewer"/>

</launch>
