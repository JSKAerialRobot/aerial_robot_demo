<?xml version="1.0"?>
<launch>
  ###########  launch config  ###########
  <arg name="real_machine" default="True" />
  <arg name="simulation" default="False" />
  <arg name="control_mode" default="0" />
  <arg name="estimate_mode"  default= "0" />
  <arg name="headless" default="True" />

  ##########  basic bringup file ########
  <include file="$(find mbzirc2020_task1_common)/launch/bringup.launch" >
    <arg name="real_machine" value="$(arg real_machine)" />
    <arg name="simulation" value="$(arg simulation)" />
    <arg name="estimate_mode"  value= "$(arg estimate_mode)" />
    <arg name="headless" value="$(arg headless)" />
  </include>

  ####### simulation #########
  <group if="$(arg simulation)">

    <arg name="x" value="2"/>
    <arg name="y" value="2"/>
    <arg name="z" value="0.3"/>

    <arg name="use_ground_truth" default="true" />
    <arg name="uav_name" default="hawk" />

    ####### virtual arena #########
    <include file="$(find gazebo_ros)/launch/empty_world.launch">
      <arg name="world_name" value="$(find mbzirc2020_task1_common)/gazebo_model/world/mbzirc_arena.world"/>
      <arg name="gui" default="false" if="$(arg headless)" />
    </include>

    ####### moving target uav ######
    <group ns="$(arg uav_name)">
      <include file="$(find hector_quadrotor_gazebo)/launch/spawn_quadrotor.launch" >
        <arg name="name" value="$(arg uav_name)"/>
        <arg name="model" value="$(find mbzirc2020_task1_common)/urdf/hawk.urdf.xacro"/>
        <arg name="use_ground_truth_for_tf" value="$(arg use_ground_truth)" />
        <arg name="use_ground_truth_for_control" value="$(arg use_ground_truth)" />
        <arg name="tf_prefix" value="$(arg uav_name)" />
        <arg name="world_frame" value="/world" />
        <arg name="x" value="$(arg x)"/>
        <arg name="y" value="$(arg y)"/>
        <arg name="z" value="$(arg z)"/>
      </include>
      <node pkg="mbzirc2020_task1_common" type="uav_teleop_keyboard" name="uav_teleop_keyboard"
            launch-prefix="xterm -e">
      </node>
    </group>

    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find mbzirc2020_task1_tasks)/config/task1.rviz" unless="$(arg headless)"/>
  </group>

</launch>
